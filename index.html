<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ERP Corabastos</title>

  <!-- Estilos básicos -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Supabase -->
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const SUPABASE_URL = "https://drvurgbsuiwnmwgikykg.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRydnVyZ2JzdWl3bm13Z2lreWtnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQyNjc2NzIsImV4cCI6MjA3OTg0MzY3Mn0.pMAsD8ogQWLy-GPXs5fAmFCeokThb3pU4q46pdzDeyw";

    // Crear cliente global
    window.supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    console.log("Supabase inicializado correctamente");
  </script>
</head>
<body>
  <h1>ERP Corabastos</h1>
  <p>Conectado a Supabase...</p>

  <!-- Tu app JS -->
  <script type="module" src="app.js"></script>
  <!-- Login Modal -->
  <div id="loginModal" style="position:fixed;inset:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center">
    <div style="background:#fff;padding:20px;border-radius:12px;width:300px;text-align:center">
      <h3>Iniciar sesión</h3>
      <input id="login_email" placeholder="Correo" style="width:100%;margin:6px 0">
      <input id="login_pass" type="password" placeholder="Contraseña" style="width:100%;margin:6px 0">
      <button id="btnLogin" style="margin-top:10px;width:100%">Entrar</button>
    </div>
  </div>

  <!-- Auth Logic -->
  <script type="module">
    const loginModal = document.getElementById("loginModal");
    const btnLogin = document.getElementById("btnLogin");
    const btnLogout = document.getElementById("btnLogout");
    const headerUser = document.getElementById("headerUser");

    async function checkSession() {
      const { data } = await supabase.auth.getSession();
      if (data.session) {
        headerUser.textContent = data.session.user.email;
        btnLogout.style.display = "block";
        loginModal.style.display = "none";
      } else {
        loginModal.style.display = "flex";
      }
    }

    btnLogin.onclick = async () => {
      const email = document.getElementById("login_email").value;
      const pass = document.getElementById("login_pass").value;

      const { error } = await supabase.auth.signInWithPassword({ email, password: pass });
      if (error) {
        alert("Credenciales incorrectas");
        return;
      }
      checkSession();
    };

    btnLogout.onclick = async () => {
      await supabase.auth.signOut();
      headerUser.textContent = "";
      btnLogout.style.display = "none";
      loginModal.style.display = "flex";
    };

    checkSession();
  </script>
</body>
</html>
